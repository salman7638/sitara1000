<odoo>
    <data>
        
        <record id="property_sale_order_view_tree" model="ir.ui.view">
            <field name="name">property.order.tree.view</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <tree sample="1" decoration-info="invoice_status == 'to invoice'" decoration-muted="state == 'cancel'">
                    <field name="message_needaction" invisible="1"/>
                    <field name="name" string="Number" readonly="1" decoration-bf="1"/>
                    <field name="date_order" string="Order Date" widget="date" optional="show"/>
                    <field name="commitment_date" optional="hide"/>
                    <field name="expected_date" optional="hide"/>
                    <field name="partner_id" readonly="1"/>
                    <field name="user_id" optional="show" widget="many2one_avatar_user"/>
                    <field name="activity_ids" widget="list_activity" optional="show"/>
                    <field name="team_id" optional="hide"/>
                    <field name="company_id" groups="base.group_multi_company" optional="show" readonly="1"/>
                    <field name="amount_untaxed" sum="Total Tax Excluded" widget="monetary" optional="hide"/>
                    <field name="amount_tax" sum="Tax Total" widget="monetary" optional="hide"/>
                    <field name="amount_total" sum="Total Tax Included" widget="monetary" decoration-bf="1" optional="show"/>
                    <field name="currency_id" invisible="1"/>
                    <field name="invoice_status" decoration-success="invoice_status == 'invoiced'" decoration-info="invoice_status == 'to invoice'" decoration-warning="invoice_status == 'upselling'" widget="badge" optional="show"/>
                    <field name="tag_ids" optional="hide" widget="many2many_tags" options="{'color_field': 'color'}"/>
                    <field name="state" invisible="0" optional="hide"/>
                    <field name="order_status" invisible="0"/>
                </tree>
            </field>
        </record>
        
        <record id="property_sale_order_form_view" model="ir.ui.view">
            <field name="name">property.sale.order.form.view</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <form string="Sales Order" class="o_sale_order" js_class="sale_discount_form">
                    <header>
                        <!--
                        <button name="%(sale.action_view_sale_advance_payment_inv)d" string="Create Invoice" type="action" class="btn-primary" data-hotkey="q" attrs="{'invisible': [('invoice_status', '!=', 'to invoice')]}"/>
                        <button name="%(sale.action_view_sale_advance_payment_inv)d" string="Create Invoice" type="action" context="{'default_advance_payment_method': 'percentage'}" data-hotkey="q" attrs="{'invisible': ['|',('invoice_status', '!=', 'no'), ('state', '!=', 'sale')]}"/>
-->
                        
                        <button name="%(de_property_sale.action_view_sale_book_advance_payment_inv)d" string="Create Installment" type="action" context="{'default_advance_payment_method': 'percentage'}" class="btn-primary" data-hotkey="q" attrs="{'invisible': [('invoice_status', '!=', 'to invoice')]}"/>

                        <button name="%(de_property_sale.action_view_sale_book_advance_payment_inv)d" string="Create Installment" type="action" context="{'default_advance_payment_method': 'percentage'}" data-hotkey="q" attrs="{'invisible': ['|',('invoice_status', '!=', 'no'), ('state', 'not in', ['draft','sent'])]}"/>

                        
                    <button name="action_quotation_send" string="Send by Email" type="object" states="draft" class="btn-primary" data-hotkey="g"/>
                    <button name="action_quotation_send" type="object" string="Send PRO-FORMA Invoice"
                      groups="sale.group_proforma_sales" class="btn-primary"
                      attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('invoice_count','&gt;=',1)]}" context="{'proforma': True}"/>
                    <button name="action_confirm" id="action_confirm" data-hotkey="v"
                        string="Confirm" class="btn-primary" type="object"
                        attrs="{'invisible': [('state', 'not in', ['sent'])]}"/>
                    <button name="action_confirm" data-hotkey="v"
                        string="Confirm" type="object"
                        attrs="{'invisible': [('state', 'not in', ['draft'])]}"/>
                    <button name="action_quotation_send" type="object" string="Send PRO-FORMA Invoice" groups="sale.group_proforma_sales" attrs="{'invisible': ['|', ('state', '=', 'draft'), ('invoice_count','&gt;=',1)]}" context="{'proforma': True}"/>
                    <button name="action_quotation_send" string="Send by Email" type="object" states="sent,sale" data-hotkey="g"/>
                    <button name="action_cancel" type="object" string="Cancel" attrs="{'invisible': ['|', ('state', 'not in', ['draft', 'sent','sale']), ('id', '=', False)]}" data-hotkey="z"/>

                        
                        <button name="action_draft" states="cancel" type="object" string="Set to Draft" data-hotkey="w"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,sent,sale"/>
                    </header>
                    <sheet>
                        <field name="order_status" invisible="1" />
                        <div class="oe_button_box" name="button_box">
                            <button name="preview_sale_order" type="object"
                            class="oe_stat_button" icon="fa-globe icon">
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_text">Customer</span>
                                    <span class="o_stat_text">Preview</span>
                                </div>
                            </button>
                            <button name="action_view_invoice"
                                type="object" class="oe_stat_button" icon="fa-pencil-square-o"
                                attrs="{'invisible': [('invoice_count', '=', 0)]}">
                                <field name="invoice_count" widget="statinfo" string="Invoices"/>
                            </button>
                        </div>
                        <div class="badge-pill badge-info float-right" attrs="{'invisible': [('order_status', 'not in', ['draft','sent'])]}">Quotation</div>
                        <div class="badge-pill badge-info float-right" attrs="{'invisible': [('order_status', '!=', 'reserved')]}">Reserved</div>
                        <div class="badge-pill badge-success float-right" attrs="{'invisible': [('order_status', '!=', 'sale')]}">Booking Confirmed</div>
                        <div class="badge-pill badge-danger float-right" attrs="{'invisible': [('order_status', 'not in', ['refund','cancel'])]}">Booking Cancelled</div>
                        <div class="badge-pill badge-danger float-right" attrs="{'invisible': [('order_status', '!=', 'expire')]}">Booking Expired</div>
                        
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        <group name="sale_header">
                        <group name="partner_details">
                            <field name="partner_id" widget="res_partner_many2one" context="{'res_partner_search_mode': 'customer', 'show_address': 1, 'show_vat': True}" options='{"always_reload": True}'/>
                            <field name="partner_invoice_id" groups="sale.group_delivery_invoice_address" context="{'default_type':'invoice'}" options='{"always_reload": True}'/>
                            <field name="partner_shipping_id" groups="sale.group_delivery_invoice_address" context="{'default_type':'delivery'}" options='{"always_reload": True}'/>
                            
                            <field name="product_id" required="1" context="{'default_can_be_property': 1, 'form_view_ref': 'de_property.product_property_unit_form_view'}"
                                   widget="many2one_barcode"
                            />
                            <label for="unit_amount" />
                            <div class="o_row" >
                                <field name="unit_amount" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                <field name="currency_id" groups="base.group_multi_currency"/>
                                <span> / </span>
                                <field name="product_uom_id" required="1" options="{'no_open': True, 'no_create': True}" class="oe_inline" groups="uom.group_uom"/>

                            </div>
                            <field name="tax_ids" widget="many2many_tags" options="{'no_create': True}" context="{'search_view_ref': 'account.account_tax_view_search'}" domain="[('type_tax_use','=','sale'), ('company_id','=',company_id), ('country_id', '=', tax_country_id)]" />
                            <field name="analytic_account_id" domain="['|', ('company_id', '=', company_id), ('company_id', '=', False)]" groups="analytic.group_analytic_accounting" />
                            <field name="analytic_tag_ids" widget="many2many_tags" groups="analytic.group_analytic_tags" />
                            
                            <field name="product_uom_category_id" invisible="1"/>
                            <field name="is_property_order" invisible="1"/>
                            <field name="invoice_status" invisible="1"/>
                        </group>
                        <group name="order_details">
                            <field name="validity_date" attrs="{'invisible': [('state', 'in', ['sale', 'done'])]}"/>
                            <div class="o_td_label" groups="base.group_no_one" attrs="{'invisible': [('state', 'in', ['sale', 'done', 'cancel'])]}">
                                <label for="date_order" string="Quotation Date"/>
                            </div>
                            <field name="date_order" nolabel="1" groups="base.group_no_one" attrs="{'invisible': [('state', 'in', ['sale', 'done', 'cancel'])]}"/>
                            <div class="o_td_label" attrs="{'invisible': [('state', 'in', ['draft', 'sent'])]}">
                                <label for="date_order" string="Order Date"/>
                            </div>
                            <field name="date_order" attrs="{'required': [('state', 'in', ['sale', 'done'])], 'invisible': [('state', 'in', ['draft', 'sent'])]}" nolabel="1"/>
                            <field name="show_update_pricelist" invisible="1"/>
                            <label for="pricelist_id" groups="product.group_product_pricelist"/>
                            <div groups="product.group_product_pricelist" class="o_row">
                                <field name="pricelist_id" options="{'no_open':True,'no_create': True}"/>
                                <button name="update_prices" type="object"
                                    string=" Update Prices"
                                    help="Recompute all prices based on this pricelist"
                                    class="btn-link mb-1 px-0" icon="fa-refresh"
                                    confirm="This will update all unit prices based on the currently set pricelist."
                                    attrs="{'invisible': ['|', ('show_update_pricelist', '=', False), ('state', 'in', ['sale', 'done','cancel'])]}"/>
                            </div>
                            <field name="currency_id" invisible="1"/>
                            <field name="tax_country_id" invisible="1"/>
                            <field name="payment_term_id" options="{'no_open':True,'no_create': True}"/>
                            <field name="payment_plan_id" options="{'no_open':True,'no_create': True}"/>
                            <field name="user_id" domain="[('share', '=', False)]" widget="many2one_avatar_user"/>
                            <field name="team_id" kanban_view_ref="%(sales_team.crm_team_view_kanban)s" options="{'no_create': True}"/>
                            <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
                        </group>
                    </group>
                        <notebook>
                            <page string="Order Lines" name="order_lines" invisible="1">
                                <field name="order_line" nolabel="1" >
                                    <tree string="Order Lines" editable="bottom" >
                                        <control>
                                            <create name="add_product_control" string="Add a product"/>
                                            <create name="add_section_control" string="Add a section" context="{'default_display_type': 'line_section'}"/>
                                            <create name="add_note_control" string="Add a note" context="{'default_display_type': 'line_note'}"/>
                                        </control>
                                        <field name="sequence" widget="handle" />
                                    <!-- We do not display the type because we don't want the user to be bothered with that information if he has no section or note. -->
                                        <field name="display_type" invisible="1"/>
                                        <field name="product_uom_category_id" invisible="1"/>

                                        <field name="product_updatable" invisible="1"/>
                                        <field name="product_id" attrs="{
                                            'readonly': [('product_updatable', '=', False)],
                                            'required': [('display_type', '=', False)],
                                        }" force_save="1"
                                        context="{
                                            'partner_id': parent.partner_id,
                                            'quantity': 1,
                                            'pricelist': parent.pricelist_id,
                                            'uom':parent.product_uom_id,
                                            'company_id': parent.company_id,
                                            'default_lst_price': parent.unit_amount,
                                        }"
                                        domain="[('can_be_property', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                    />
                                        <field
                                        name="product_uom_qty"
                                        decoration-info="(not display_type and invoice_status == 'to invoice')" decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                        context="{
                                            'partner_id': parent.partner_id,
                                            'quantity': product_uom_qty,
                                            'pricelist': parent.pricelist_id,
                                            'uom': product_uom,
                                            'company_id': parent.company_id
                                        }"
                                    />
                                    <field
                                        name="qty_delivered"
                                        decoration-info="(not display_type and invoice_status == 'to invoice')" decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                        string="Delivered"
                                        attrs="{
                                            'column_invisible': [('parent.state', 'not in', ['sale', 'done'])],
                                            'readonly': [('qty_delivered_method', '!=', 'manual')]
                                        }"
                                        optional="show"
                                    />
                                    <field name="qty_delivered_manual" invisible="1"/>
                                    <field name="qty_delivered_method" invisible="1"/>
                                    <field
                                        name="qty_invoiced"
                                        decoration-info="(not display_type and invoice_status == 'to invoice')" decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                        string="Invoiced"
                                        attrs="{'column_invisible': [('parent.state', 'not in', ['sale', 'done'])]}"
                                        optional="show"
                                    />
                                    <field name="qty_to_invoice" invisible="1"/>
                                    <field name="product_uom_readonly" invisible="1"/>
                                    <field
                                        name="product_uom"
                                        force_save="1"
                                        string="UoM"
                                        attrs="{
                                            'readonly': [('product_uom_readonly', '=', True)],
                                            'required': [('display_type', '=', False)],
                                        }"
                                        context="{'company_id': parent.company_id}"
                                        groups="uom.group_uom"
                                        options='{"no_open": True}'
                                        optional="show"
                                    />
                                    <field
                                        name="customer_lead"
                                        optional="hide"
                                        attrs="{'readonly': [('parent.state', 'not in', ['draft', 'sent', 'sale'])]}"
                                    />
                                    <field name="product_packaging_qty" attrs="{'invisible': ['|', ('product_id', '=', False), ('product_packaging_id', '=', False)]}" groups="product.group_stock_packaging" optional="show"/>
                                    <field name="product_packaging_id" attrs="{'invisible': [('product_id', '=', False)]}" context="{'default_product_id': product_id, 'tree_view_ref':'product.product_packaging_tree_view', 'form_view_ref':'product.product_packaging_form_view'}" groups="product.group_stock_packaging" optional="show"/>
                                    <field
                                        name="price_unit"
                                        attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"
                                    />
                                    <field
                                        name="tax_id"
                                        widget="many2many_tags"
                                        options="{'no_create': True}"
                                        domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id), ('country_id', '=', parent.tax_country_id)]"
                                        attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"
                                        optional="show"
                                    />
                                    <field name="discount" string="Disc.%" groups="product.group_discount_per_so_line" optional="show" widget="product_discount"/>
                                    <field name="price_subtotal" widget="monetary" groups="account.group_show_line_subtotals_tax_excluded"/>
                                    <field name="price_total" widget="monetary" groups="account.group_show_line_subtotals_tax_included"/>
                                    <field name="state" invisible="1"/>
                                    <field name="invoice_status" invisible="1"/>
                                    <field name="currency_id" invisible="1"/>
                                    <field name="price_tax" invisible="1"/>
                                    <field name="company_id" invisible="1"/>
                                    </tree>
                                </field>
                                <group name="note_group" col="6" class="mt-2 mt-md-0">
                                <group colspan="4">
                                    <field name="note" nolabel="1" placeholder="Terms and conditions..."/>
                                </group>
                                <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
                                    <field name="tax_totals_json" widget="account-tax-totals-field" nolabel="1" colspan="2"/>
                                </group>
                                <div class="oe_clear"/>
                            </group>
                            </page>
                            <page string="Installments" name="installment">
                                <field name="payment_line" nolabel="1" >
                                    <tree string="Installment Lines" editable="bottom" >
                                        <field name="sequence" invisible="1" />
                                        <field name="name" />
                                        <field name="display_name" invisible="1" />
                                        <field name="currency_id" invisible="1"/>
                                        <field name="company_id" invisible="1"/>
                                        <field name="date_due" />
                                        <field name="amount_installment" />
                                        <field name="amount_residual" />
                                        <field name="payment_status" />
                                        <field name="move_id" readonly="1" optional="hide"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Other Info" name="other_information">
                                <group>
                                <group name="sales_person" string="Sales">
                                    <field name="user_id" domain="[('share', '=', False)]" widget="many2one_avatar_user"/>
                                    <field name="team_id" kanban_view_ref="%(sales_team.crm_team_view_kanban)s" options="{'no_create': True}"/>
                                    <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
                                    <field name="require_signature"/>
                                    <field name="require_payment"/>
                                    <field name="reference" readonly="1" attrs="{'invisible': [('reference', '=', False)]}"/>
                                    <field name="client_order_ref"/>
                                    <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color', 'no_create_edit': True}"/>
                                </group>
                                <group name="sale_info" string="Invoicing">
                                    <field name="fiscal_position_id" options="{'no_create': True}"/>
                                    <field name="analytic_account_id" context="{'default_partner_id':partner_invoice_id, 'default_name':name}" attrs="{'readonly': [('invoice_count','!=',0),('state','=','sale')]}" groups="analytic.group_analytic_accounting" force_save="1"/>
                                    <field name="invoice_status" states="sale,done" groups="base.group_no_one"/>
                                </group>
                            </group>
                            <group>
                                <group name="sale_shipping">
                                    <label for="commitment_date" string="Delivery Date"/>
                                    <div name="commitment_date_div" class="o_row">
                                        <field name="commitment_date"/>
                                        <span name="expected_date_span" class="text-muted">Expected: <field name="expected_date" widget="date"/></span>
                                    </div>
                                </group>
                                <group string="Tracking" name="sale_reporting">
                                    <group name="technical" colspan="2" class="mb-0">
                                        <field name="origin"/>
                                    </group>
                                    <group name="utm_link" colspan="2" class="mt-0">
                                        <field name="campaign_id"/>
                                        <field name="medium_id"/>
                                        <field name="source_id"/>
                                    </group>
                                </group>
                            </group>
                            </page>
                            <page groups="base.group_no_one" string="Customer Signature" name="customer_signature" attrs="{'invisible': [('require_signature', '=', False), ('signed_by', '=', False), ('signature', '=', False), ('signed_on', '=', False)]}">
                                <group>
                                    <field name="signed_by"/>
                                    <field name="signed_on"/>
                                    <field name="signature" widget="image"/>
                                </group>
                            </page>
                            
                        </notebook>
                        <group name="note_group" col="6" class="mt-2 mt-md-0">
                                <group colspan="4">
                                    <field name="note" nolabel="1" placeholder="Terms and conditions..."/>
                                </group>
                                <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
                                    <field name="tax_totals_json" widget="account-tax-totals-field" nolabel="1" colspan="2"/>
                                </group>
                                <div class="oe_clear"/>
                            </group>
                  </sheet>
                    <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
                </form>
            </field>
        </record>
        <!--
        <record id="property_sale_order_order_form_view" model="ir.ui.view">
            <field name="name">property.sale.order.order.form.view</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="de_property_sale.property_sale_order_form_view"/>
            <field name="arch" type="xml">
            </field>
        </record>
-->
        <record id="action_property_sale_order" model="ir.actions.act_window">
            <field name="name">Sale Order</field>
            <field name="res_model">sale.order</field>
            <field name="domain">[('is_property_order','=',True)]</field>
            <field name="view_mode">tree,kanban,form,calendar,pivot,graph,activity</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('property_sale_order_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('property_sale_order_form_view')})]"/>
            <field name="context">{'default_is_property_order':True}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                Create a new quotation, the first step of a new sale!
              </p><p>
                Once the quotation is confirmed by the customer, it becomes a sales order.<br/> You will be able to create an invoice and collect the payment.
              </p>
            </field>
        </record>
        
        <record id="action_property_sale_booking" model="ir.actions.act_window">
            <field name="name">Booking</field>
            <field name="res_model">sale.order</field>
            <field name="domain">[('is_property_order','=',True)]</field>
            <field name="view_mode">tree,kanban,form,calendar,pivot,graph,activity</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('property_sale_order_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('property_sale_order_form_view')})]"/>
            <!--
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('view_project')}),
                (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_project_kanban')})]"/>
            <field name="search_view_id" ref="view_project_project_filter"/>
-->
            <field name="context">{'default_is_property_order':True}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                Create a new quotation, the first step of a new sale!
              </p><p>
                Once the quotation is confirmed by the customer, it becomes a sales order.<br/> You will be able to create an invoice and collect the payment.
              </p>
            </field>
        </record>
        
        
   
        <menuitem id="property_sale_booking" name="Booking" parent="de_property.menu_property_orders" action="action_property_sale_booking" sequence="10"/>
        
        <menuitem id="property_sale_order" name="Order" parent="de_property.menu_property_orders" action="action_property_sale_order" sequence="20"/>


        
    </data>
</odoo>